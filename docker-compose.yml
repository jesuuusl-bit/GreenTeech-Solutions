version: '3.8'

services:
  # MongoDB Database
  mongodb:
    image: mongo:7.0
    container_name: greentech-mongodb
    restart: unless-stopped
    ports:
      - "27017:27017"
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: admin
    volumes:
      - mongodb_data:/data/db
    networks:
      - greentech-network

  # API Gateway
  api-gateway:
    build: ./backend/api-gateway
    container_name: greentech-gateway
    restart: unless-stopped
    ports:
      - "5000:5000"
    environment:
      - NODE_ENV=development
      - PORT=5000
      - JWT_SECRET=your-super-secret-jwt-key-change-in-production
      - USERS_SERVICE_URL=http://users-service:5001
      - PROJECTS_SERVICE_URL=http://projects-service:5002
      - MONITORING_SERVICE_URL=http://monitoring-service:5003
      - PREDICTIVE_SERVICE_URL=http://predictive-service:5004
      - DOCUMENTS_SERVICE_URL=http://documents-service:5005
    depends_on:
      - users-service
      - projects-service
      - monitoring-service
      - predictive-service
      - documents-service
    networks:
      - greentech-network

  # Users Microservice
  users-service:
    build: ./backend/users-service
    container_name: greentech-users
    restart: unless-stopped
    ports:
      - "5001:5001"
    environment:
      - NODE_ENV=development
      - PORT=5001
      - MONGO_URI=mongodb+srv://admin:admin@cluster0.x1gyy29.mongodb.net/greentech_users?appName=Cluster0
      - JWT_SECRET=your-super-secret-jwt-key-change-in-production
      - JWT_EXPIRE=7d
    networks:
      - greentech-network

  # Projects Microservice
  projects-service:
    build: ./backend/projects-service
    container_name: greentech-projects
    restart: unless-stopped
    ports:
      - "5002:5002"
    environment:
      - NODE_ENV=development
      - PORT=5002
      - MONGO_URI=mongodb+srv://admin:admin@cluster0.x1gyy29.mongodb.net/greentech_projects?appName=Cluster0
    networks:
      - greentech-network

  # Monitoring Microservice
  monitoring-service:
    build: ./backend/monitoring-service
    container_name: greentech-monitoring
    restart: unless-stopped
    ports:
      - "5003:5003"
    environment:
      - NODE_ENV=development
      - PORT=5003
      - MONGO_URI=mongodb+srv://admin:admin@cluster0.x1gyy29.mongodb.net/greentech_monitoring?appName=Cluster0
    networks:
      - greentech-network

  # Predictive Microservice
  predictive-service:
    build: ./backend/predictive-service
    container_name: greentech-predictive
    restart: unless-stopped
    ports:
      - "5004:5004"
    environment:
      - NODE_ENV=development
      - PORT=5004
      - MONGO_URI=mongodb+srv://admin:admin@cluster0.x1gyy29.mongodb.net/greentech_predictive?appName=Cluster0
      - WEATHER_API_KEY=your-weather-api-key
    networks:
      - greentech-network

  # Documents Microservice
  documents-service:
    build: ./backend/documents-service
    container_name: greentech-documents
    restart: unless-stopped
    ports:
      - "5005:5005"
    environment:
      - NODE_ENV=development
      - PORT=5005
      - MONGO_URI=mongodb+srv://admin:admin@cluster0.x1gyy29.mongodb.net/greentech_documents?appName=Cluster0
      - MAX_FILE_SIZE=10485760
    volumes:
      - documents_storage:/app/uploads
    networks:
      - greentech-network

networks:
  greentech-network:
    driver: bridge

volumes:
  mongodb_data:
  documents_storage: